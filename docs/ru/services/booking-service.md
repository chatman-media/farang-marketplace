# üìÖ Booking Service

## üìã –û–±–∑–æ—Ä

Booking Service - —ç—Ç–æ —Å–µ—Ä–≤–∏—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏ –∏ —Ä–µ–∑–µ—Ä–≤–∞—Ü–∏—è–º–∏ –Ω–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç–∏. –û–Ω –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞–º–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã.

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏

- **–ü–æ—Ä—Ç —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏**: 3003
- **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö**: PostgreSQL (booking_service_db)
- **ORM**: Drizzle ORM
- **–û—á–µ—Ä–µ–¥–∏**: Redis + Bull Queue
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: Vitest (4 —Ç–µ—Å—Ç–∞)
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏**: 90%+

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
services/booking-service/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ controllers/     # –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã API
‚îÇ   ‚îú‚îÄ‚îÄ middleware/      # –ü—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω–æ–µ –ü–û
‚îÇ   ‚îú‚îÄ‚îÄ models/         # –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ routes/         # –ú–∞—Ä—à—Ä—É—Ç—ã API
‚îÇ   ‚îú‚îÄ‚îÄ services/       # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ calendar/   # –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ payment/    # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notification/ # –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ utils/          # –£—Ç–∏–ª–∏—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ db/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ë–î
‚îÇ   ‚îú‚îÄ‚îÄ jobs/           # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ   ‚îî‚îÄ‚îÄ types/          # TypeScript —Ç–∏–ø—ã
‚îú‚îÄ‚îÄ tests/              # –¢–µ—Å—Ç—ã
‚îî‚îÄ‚îÄ package.json
```

### –ú–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö

#### Booking (–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
```typescript
interface Booking {
  id: string;                    // UUID
  listingId: string;             // ID –æ–±—ä—è–≤–ª–µ–Ω–∏—è
  guestId: string;               // ID –≥–æ—Å—Ç—è
  hostId: string;                // ID —Ö–æ–∑—è–∏–Ω–∞
  agencyId?: string;             // ID –∞–≥–µ–Ω—Ç—Å—Ç–≤–∞
  
  // –î–∞—Ç—ã –∏ –≤—Ä–µ–º—è
  checkIn: Date;                 // –î–∞—Ç–∞ –∑–∞–µ–∑–¥–∞
  checkOut: Date;                // –î–∞—Ç–∞ –≤—ã–µ–∑–¥–∞
  nights: number;                // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ—á–µ–π
  
  // –ì–æ—Å—Ç–∏
  adults: number;                // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–∑—Ä–æ—Å–ª—ã—Ö
  children: number;              // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–µ—Ç–µ–π
  infants: number;               // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –º–ª–∞–¥–µ–Ω—Ü–µ–≤
  totalGuests: number;           // –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ—Å—Ç–µ–π
  
  // –§–∏–Ω–∞–Ω—Å—ã
  basePrice: number;             // –ë–∞–∑–æ–≤–∞—è —Ü–µ–Ω–∞ –∑–∞ –Ω–æ—á—å
  totalPrice: number;            // –û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å
  currency: Currency;            // –í–∞–ª—é—Ç–∞
  fees: BookingFee[];           // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Å–±–æ—Ä—ã
  taxes: BookingTax[];          // –ù–∞–ª–æ–≥–∏
  
  // –°—Ç–∞—Ç—É—Å—ã
  status: BookingStatus;         // PENDING, CONFIRMED, CANCELLED, etc.
  paymentStatus: PaymentStatus;  // PENDING, PAID, REFUNDED, etc.
  
  // –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è
  guestInfo: GuestInfo;
  specialRequests?: string;      // –û—Å–æ–±—ã–µ –ø–æ–∂–µ–ª–∞–Ω–∏—è
  
  // –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
  source: BookingSource;         // WEB, MOBILE, API, PHONE
  cancellationPolicy: CancellationPolicy;
  
  // –í—Ä–µ–º–µ–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
  createdAt: Date;
  updatedAt: Date;
  confirmedAt?: Date;
  cancelledAt?: Date;
  expiresAt: Date;               // –í—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
}
```

#### BookingStatus (–°—Ç–∞—Ç—É—Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è)
```typescript
enum BookingStatus {
  PENDING = 'PENDING',           // –û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
  CONFIRMED = 'CONFIRMED',       // –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ
  CHECKED_IN = 'CHECKED_IN',     // –ó–∞—Å–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ
  CHECKED_OUT = 'CHECKED_OUT',   // –í—ã—Å–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–æ—à–ª–æ
  CANCELLED = 'CANCELLED',       // –û—Ç–º–µ–Ω–µ–Ω–æ
  NO_SHOW = 'NO_SHOW',          // –ù–µ —è–≤–∏–ª—Å—è
  EXPIRED = 'EXPIRED'            // –ò—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
}
```

#### Availability (–î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å)
```typescript
interface Availability {
  id: string;
  listingId: string;
  date: Date;                    // –ö–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–∞—Ç–∞
  available: boolean;            // –î–æ—Å—Ç—É–ø–Ω–æ –ª–∏
  price: number;                 // –¶–µ–Ω–∞ –∑–∞ —ç—Ç—É –¥–∞—Ç—É
  minStay: number;              // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ—á–µ–π
  maxStay: number;              // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–æ—á–µ–π
  checkInAllowed: boolean;       // –†–∞–∑—Ä–µ—à–µ–Ω –ª–∏ –∑–∞–µ–∑–¥
  checkOutAllowed: boolean;      // –†–∞–∑—Ä–µ—à–µ–Ω –ª–∏ –≤—ã–µ–∑–¥
  restrictions: DateRestriction[]; // –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
  createdAt: Date;
  updatedAt: Date;
}
```

#### BookingFee (–°–±–æ—Ä)
```typescript
interface BookingFee {
  id: string;
  bookingId: string;
  type: FeeType;                 // CLEANING, SERVICE, SECURITY_DEPOSIT, etc.
  name: string;                  // –ù–∞–∑–≤–∞–Ω–∏–µ —Å–±–æ—Ä–∞
  amount: number;                // –°—É–º–º–∞
  currency: Currency;
  taxable: boolean;              // –û–±–ª–∞–≥–∞–µ—Ç—Å—è –ª–∏ –Ω–∞–ª–æ–≥–æ–º
  mandatory: boolean;            // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ª–∏
  description?: string;
}
```

## üóìÔ∏è –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –Ω–∞ 2 –≥–æ–¥–∞ –≤–ø–µ—Ä–µ–¥
- –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–∞—Ç –¥–ª—è –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏—è
- –°–µ–∑–æ–Ω–Ω–æ–µ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Å—Ä–æ–∫–∏ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∑–∞–µ–∑–¥/–≤—ã–µ–∑–¥

### –ü—Ä–∞–≤–∏–ª–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- Advance booking (–∑–∞–±–ª–∞–≥–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
- Same-day booking (–±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –¥–µ–Ω—å –∑–∞–µ–∑–¥–∞)
- Instant booking (–º–≥–Ω–æ–≤–µ–Ω–Ω–æ–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)
- Request to book (–∑–∞–ø—Ä–æ—Å –Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ)

## üåê API Endpoints

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

#### GET /api/availability/:listingId
–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏—è

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```
?checkIn=2024-03-15
&checkOut=2024-03-20
&guests=2
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "available": true,
    "dates": [
      {
        "date": "2024-03-15",
        "available": true,
        "price": 2500,
        "checkInAllowed": true
      }
    ],
    "totalPrice": 12500,
    "nights": 5,
    "fees": [
      {
        "type": "CLEANING",
        "name": "Cleaning Fee",
        "amount": 1000
      }
    ]
  }
}
```

#### POST /api/availability/bulk
–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –¥–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π

### –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

#### POST /api/bookings
–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "listingId": "listing-uuid",
  "checkIn": "2024-03-15",
  "checkOut": "2024-03-20",
  "guests": {
    "adults": 2,
    "children": 0,
    "infants": 0
  },
  "guestInfo": {
    "firstName": "John",
    "lastName": "Doe",
    "email": "john@example.com",
    "phone": "+66123456789",
    "nationality": "US"
  },
  "specialRequests": "Late check-in around 10 PM",
  "paymentMethodId": "pm_1234567890"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "success": true,
  "data": {
    "booking": {
      "id": "booking-uuid",
      "status": "PENDING",
      "totalPrice": 13500,
      "currency": "THB",
      "expiresAt": "2024-01-15T12:00:00Z"
    },
    "paymentIntent": {
      "id": "pi_1234567890",
      "clientSecret": "pi_1234567890_secret_xyz"
    }
  }
}
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏

#### GET /api/bookings/:id
–ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–∏

#### PUT /api/bookings/:id/confirm
–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

#### PUT /api/bookings/:id/cancel
–û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "reason": "GUEST_CANCELLED",
  "note": "Guest had to cancel due to emergency"
}
```

#### GET /api/bookings
–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã:**
```
?status=CONFIRMED
&checkIn=2024-03-01
&checkOut=2024-03-31
&guestId=user-uuid
&page=1
&limit=20
```

### –ö–∞–ª–µ–Ω–¥–∞—Ä—å —Ö–æ–∑—è–∏–Ω–∞

#### GET /api/host/calendar/:listingId
–ü–æ–ª—É—á–µ–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä—è –¥–ª—è —Ö–æ–∑—è–∏–Ω–∞

#### PUT /api/host/availability/:listingId
–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "dates": [
    {
      "date": "2024-03-15",
      "available": false,
      "reason": "MAINTENANCE"
    },
    {
      "date": "2024-03-16",
      "available": true,
      "price": 3000,
      "minStay": 2
    }
  ]
}
```

#### POST /api/host/block-dates
–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–∞—Ç

### –ß–µ–∫-–∏–Ω/—á–µ–∫-–∞—É—Ç

#### POST /api/bookings/:id/checkin
–û—Ç–º–µ—Ç–∫–∞ –æ –∑–∞—Å–µ–ª–µ–Ω–∏–∏

#### POST /api/bookings/:id/checkout
–û—Ç–º–µ—Ç–∫–∞ –æ –≤—ã—Å–µ–ª–µ–Ω–∏–∏

**–ó–∞–ø—Ä–æ—Å:**
```json
{
  "actualCheckIn": "2024-03-15T15:30:00Z",
  "guestCount": 2,
  "notes": "Guests arrived on time, provided all documents"
}
```

## üí∞ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ø–ª–∞—Ç–µ–∂–∞–º–∏

### Payment Service –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
```typescript
// –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –Ω–∞–º–µ—Ä–µ–Ω–∏—è
const paymentIntent = await paymentService.createIntent({
  amount: booking.totalPrice,
  currency: booking.currency,
  bookingId: booking.id,
  customerId: booking.guestId
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
const handlePaymentSuccess = async (paymentIntentId: string) => {
  const booking = await bookingService.confirmPayment(paymentIntentId);
  await notificationService.sendConfirmation(booking);
};
```

### –ü–æ–ª–∏—Ç–∏–∫–∏ –æ—Ç–º–µ–Ω—ã
- **Flexible**: –ü–æ–ª–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –∑–∞ 24 —á–∞—Å–∞ –¥–æ –∑–∞–µ–∑–¥–∞
- **Moderate**: –ü–æ–ª–Ω—ã–π –≤–æ–∑–≤—Ä–∞—Ç –∑–∞ 5 –¥–Ω–µ–π –¥–æ –∑–∞–µ–∑–¥–∞
- **Strict**: –í–æ–∑–≤—Ä–∞—Ç 50% –∑–∞ 7 –¥–Ω–µ–π –¥–æ –∑–∞–µ–∑–¥–∞
- **Super Strict**: –í–æ–∑–≤—Ä–∞—Ç 50% –∑–∞ 30 –¥–Ω–µ–π –¥–æ –∑–∞–µ–∑–¥–∞
- **Non-refundable**: –ë–µ–∑ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤

## üì± –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

### –¢–∏–ø—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
1. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è**
2. **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –ø–ª–∞—Ç–µ–∂–µ**
3. **–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –¥–ª—è –∑–∞—Å–µ–ª–µ–Ω–∏—è**
4. **–ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ –∑–∞—Å–µ–ª–µ–Ω–∏–∏**
5. **–ó–∞–ø—Ä–æ—Å –æ—Ç–∑—ã–≤–∞**
6. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ–± –æ—Ç–º–µ–Ω–µ**

### –ö–∞–Ω–∞–ª—ã —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- Email
- SMS
- Push —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- In-app —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

## üîÑ –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
```typescript
// –ò—Å—Ç–µ—á–µ–Ω–∏–µ –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
const expireBookings = async () => {
  const expiredBookings = await bookingService.findExpired();
  for (const booking of expiredBookings) {
    await bookingService.expire(booking.id);
    await availabilityService.releaseBlocked(booking.listingId, booking.dates);
  }
};

// –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —á–µ–∫-–∞—É—Ç
const autoCheckout = async () => {
  const overdueBookings = await bookingService.findOverdueCheckouts();
  for (const booking of overdueBookings) {
    await bookingService.autoCheckout(booking.id);
  }
};
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏ (4 —Ç–µ—Å—Ç–∞)

1. **booking.test.ts** - –û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
   - –°–æ–∑–¥–∞–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –û—Ç–º–µ–Ω–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤

2. **availability.test.ts** - –ö–∞–ª–µ–Ω–¥–∞—Ä—å –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
   - –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–∞—Ç
   - –¶–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ
   - –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

3. **payment.test.ts** - –ü–ª–∞—Ç–µ–∂–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
   - –°–æ–∑–¥–∞–Ω–∏–µ –ø–ª–∞—Ç–µ–∂–Ω–æ–≥–æ –Ω–∞–º–µ—Ä–µ–Ω–∏—è
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Å–ø–µ—à–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
   - –û–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–µ—É–¥–∞—á–Ω–æ–≥–æ –ø–ª–∞—Ç–µ–∂–∞
   - –í–æ–∑–≤—Ä–∞—Ç—ã

4. **calendar.test.ts** - –ö–∞–ª–µ–Ω–¥–∞—Ä–Ω–∞—è –ª–æ–≥–∏–∫–∞
   - –†–∞—Å—á–µ—Ç –Ω–æ—á–µ–π
   - –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–π
   - –í–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞—Ç
   - –ß–∞—Å–æ–≤—ã–µ –ø–æ—è—Å–∞

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
```bash
# –í—Å–µ —Ç–µ—Å—Ç—ã
bun test

# –¢–µ—Å—Ç—ã —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º
bun test --coverage

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
bun test:integration
```

## üöÄ –†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```env
# –°–µ—Ä–≤–µ—Ä
PORT=3003
NODE_ENV=production

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DATABASE_URL=postgresql://user:password@localhost:5432/booking_service_db

# Redis
REDIS_URL=redis://localhost:6379

# –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
PAYMENT_SERVICE_URL=http://localhost:3004
LISTING_SERVICE_URL=http://localhost:3002
USER_SERVICE_URL=http://localhost:3001
CRM_SERVICE_URL=http://localhost:3008

# –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
EMAIL_SERVICE_URL=http://localhost:3009
SMS_PROVIDER_API_KEY=your-sms-api-key

# –í—Ä–µ–º–µ–Ω–Ω—ã–µ –∑–æ–Ω—ã
DEFAULT_TIMEZONE=Asia/Bangkok

# –ë–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª–∞
BOOKING_EXPIRY_HOURS=24
MAX_ADVANCE_BOOKING_DAYS=365
MIN_ADVANCE_BOOKING_HOURS=2

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
SENTRY_DSN=your-sentry-dsn
```

## üîÑ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- **Payment Service**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π –∏ –≤–æ–∑–≤—Ä–∞—Ç–æ–≤
- **Listing Service**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ–±—ä—è–≤–ª–µ–Ω–∏—è—Ö
- **User Service**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **CRM Service**: –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –∏ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

### –í–Ω–µ—à–Ω–∏–µ —Å–µ—Ä–≤–∏—Å—ã
- **Stripe**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–µ–π
- **Twilio**: SMS —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **SendGrid**: Email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è
- **Google Calendar**: –°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–π

## üìä –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞

### –ü—Ä–∞–≤–∏–ª–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
1. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏** –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º
2. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–∞—Ç** –Ω–∞ –≤—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç–µ–∂–∞
3. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –∏—Å—Ç–µ—á–µ–Ω–∏–µ** –Ω–µ–æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
4. **–ü–æ–ª–∏—Ç–∏–∫–∏ –æ—Ç–º–µ–Ω—ã** –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏—è
5. **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ/–º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–µ —Å—Ä–æ–∫–∏** –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è

### –†–∞—Å—á–µ—Ç —Å—Ç–æ–∏–º–æ—Å—Ç–∏
```typescript
const calculateTotalPrice = (booking: BookingRequest) => {
  const basePrice = calculateBasePrice(booking.dates, booking.listingId);
  const fees = calculateFees(booking.listingId, basePrice);
  const taxes = calculateTaxes(basePrice + fees, booking.location);
  
  return {
    basePrice,
    fees,
    taxes,
    total: basePrice + fees + taxes
  };
};
```

## üìà –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ–π –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- –ò–Ω–¥–µ–∫—Å—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –ø–æ–∏—Å–∫–∞
- –ü–∞–≥–∏–Ω–∞—Ü–∏—è —Å–ø–∏—Å–∫–æ–≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π

### –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ
- –®–∞—Ä–¥–∏–Ω–≥ –ø–æ —Ä–µ–≥–∏–æ–Ω–∞–º
- –û—á–µ—Ä–µ–¥–∏ –¥–ª—è —Ñ–æ–Ω–æ–≤—ã—Ö –∑–∞–¥–∞—á
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ Redis

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- –ö–æ–Ω–≤–µ—Ä—Å–∏—è –∏–∑ –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–≤ –≤ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
- –í—Ä–µ–º—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- –ü—Ä–æ—Ü–µ–Ω—Ç –æ—Ç–º–µ–Ω

### –ê–ª–µ—Ä—Ç—ã
- –í—ã—Å–æ–∫–æ–µ –≤—Ä–µ–º—è –æ—Ç–≤–µ—Ç–∞ API
- –û—à–∏–±–∫–∏ –ø–ª–∞—Ç–µ–∂–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã
- –ü—Ä–µ–≤—ã—à–µ–Ω–∏–µ –ª–∏–º–∏—Ç–∞ –Ω–µ–ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–Ω—ã—Ö –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
- –ü—Ä–æ–±–ª–µ–º—ã —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏

---

**–ö–æ–Ω—Ç–∞–∫—Ç—ã –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏:**
- üìß Email: booking-service@thailand-marketplace.com
- üì± Slack: #booking-service-support
- üìã Issues: [GitHub Issues](https://github.com/chatman-media/farang-marketplace/issues?label=booking-service)