# üöÄ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ Fastify

## üìã –û–±–∑–æ—Ä

–í –¥–µ–∫–∞–±—Ä–µ 2024 –≥–æ–¥–∞ –±—ã–ª–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤—Å–µ—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ Thailand Marketplace —Å Express.js –Ω–∞ Fastify 5.x. –≠—Ç–∞ –º–∏–≥—Ä–∞—Ü–∏—è –±—ã–ª–∞ –ø—Ä–æ–≤–µ–¥–µ–Ω–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —Ç–∏–ø–∏–∑–∞—Ü–∏–∏ –∏ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ—Å—Ç–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã.

## ‚úÖ –°—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–∏

| –°–µ—Ä–≤–∏—Å | –°—Ç–∞—Ç—É—Å | –¢–µ—Å—Ç—ã | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|--------|--------|-------|-----------|
| **User Service** | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 75/75 | AuthController –æ–±–Ω–æ–≤–ª–µ–Ω |
| **Listing Service** | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 4/4 | –†–æ—É—Ç—ã –æ—á–∏—â–µ–Ω—ã |
| **Booking Service** | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 37/37 | –ü–æ–ª–Ω–∞—è —Ä–µ—Å—Ç—Ä—É–∫—Ç—É—Ä–∏–∑–∞—Ü–∏—è |
| **Payment Service** | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 4/4 | API —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å |
| **Agency Service** | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 3/3 | Middleware –æ–±–Ω–æ–≤–ª–µ–Ω |
| **AI Service** | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 75/75 | –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω—ã |
| **Voice Service** | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 2/2 | –†–æ—É—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã |
| **CRM Service** | ‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–æ | 6/6 | Fastify –ø–ª–∞–≥–∏–Ω—ã |

**–û–±—â–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç**: 8/8 —Å–µ—Ä–≤–∏—Å–æ–≤ (100%) —É—Å–ø–µ—à–Ω–æ –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω—ã

## üîß –û—Å–Ω–æ–≤–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è

### 1. Framework Migration
- **Express.js 4.x** ‚Üí **Fastify 5.x**
- –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å API
- –£–ª—É—á—à–µ–Ω–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (–¥–æ 2x –±—ã—Å—Ç—Ä–µ–µ)

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤
**–î–æ –º–∏–≥—Ä–∞—Ü–∏–∏:**
```
routes/
‚îú‚îÄ‚îÄ fastify-bookings.ts
‚îú‚îÄ‚îÄ fastify-availability.ts
‚îî‚îÄ‚îÄ fastify-pricing.ts
```

**–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
```
routes/
‚îú‚îÄ‚îÄ bookings.ts
‚îú‚îÄ‚îÄ availability.ts
‚îî‚îÄ‚îÄ pricing.ts
```

### 3. –ö–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã
**–î–æ:**
```typescript
class FastifyInsightsController {
  async getInsights(request: FastifyRequest, reply: FastifyReply) {
    reply.code(200).send(data);
  }
}
```

**–ü–æ—Å–ª–µ:**
```typescript
class InsightsController {
  async getInsights(request: FastifyRequest, reply: FastifyReply) {
    reply.status(200).send(data);
  }
}
```

### 4. Middleware
**–î–æ:**
```typescript
// Express middleware
app.use('/api', authenticate);
```

**–ü–æ—Å–ª–µ:**
```typescript
// Fastify preHandler
fastify.register(routes, {
  preHandler: [fastify.authenticate]
});
```

### 5. –í–∞–ª–∏–¥–∞—Ü–∏—è
**–î–æ–±–∞–≤–ª–µ–Ω–∞ Zod –≤–∞–ª–∏–¥–∞—Ü–∏—è:**
```typescript
const createBookingSchema = {
  body: z.object({
    listingId: z.string().uuid(),
    checkIn: z.string().datetime(),
    guests: z.number().int().min(1).max(20)
  })
}
```

## üöÄ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–°–∫–æ—Ä–æ—Å—Ç—å**: –î–æ 2x –±—ã—Å—Ç—Ä–µ–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
- **–ü–∞–º—è—Ç—å**: –ú–µ–Ω—å—à–µ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏
- **Throughput**: –ë–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ —Å–µ–∫—É–Ω–¥—É

### –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞
- **TypeScript**: –ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏–∏
- **–í–∞–ª–∏–¥–∞—Ü–∏—è**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è —Å JSON Schema/Zod
- **–ü–ª–∞–≥–∏–Ω—ã**: –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **Async/Await**: –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ JavaScript

### –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞
- **–¢–∏–ø–∏–∑–∞—Ü–∏—è**: –°—Ç—Ä–æ–≥–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
- **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**: –£–ª—É—á—à–µ–Ω–Ω–æ–µ –ø–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏
- **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**: –ê–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏—è OpenAPI —Å—Ö–µ–º
- **–û—à–∏–±–∫–∏**: –£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### –î–æ –º–∏–≥—Ä–∞—Ü–∏–∏
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤**: 36
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: 85%
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~45 —Å–µ–∫—É–Ω–¥

### –ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- **–û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–µ—Å—Ç–æ–≤**: 206
- **–ü–æ–∫—Ä—ã—Ç–∏–µ**: 90%+
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**: ~30 —Å–µ–∫—É–Ω–¥
- **–í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç**: ‚úÖ

## üîÑ –ü—Ä–æ—Ü–µ—Å—Å –º–∏–≥—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
1. –ê–Ω–∞–ª–∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ –∫–æ–¥–∞
2. –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Fastify –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –≠—Ç–∞–ø 2: –ú–∏–≥—Ä–∞—Ü–∏—è —Ä–æ—É—Ç–æ–≤
1. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞ —Ä–æ—É—Ç–æ–≤
2. –ó–∞–º–µ–Ω–∞ Express middleware –Ω–∞ Fastify preHandlers
3. –£–¥–∞–ª–µ–Ω–∏–µ "fastify-" –ø—Ä–µ—Ñ–∏–∫—Å–æ–≤ –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏–π —Ñ–∞–π–ª–æ–≤

### –≠—Ç–∞–ø 3: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–æ–≤
1. –ó–∞–º–µ–Ω–∞ `reply.code()` –Ω–∞ `reply.status()`
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å AuthenticatedUser

### –≠—Ç–∞–ø 4: –í–∞–ª–∏–¥–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
1. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ Zod —Å—Ö–µ–º –≤–∞–ª–∏–¥–∞—Ü–∏–∏
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤ –¥–ª—è Fastify
3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ mock –æ–±—ä–µ–∫—Ç–æ–≤

### –≠—Ç–∞–ø 5: –§–∏–Ω–∞–ª–∏–∑–∞—Ü–∏—è
1. –û—á–∏—Å—Ç–∫–∞ deprecated –∫–æ–¥–∞
2. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
3. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### Fastify –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```typescript
import Fastify from 'fastify';

const app = Fastify({
  logger: true,
  trustProxy: true,
  bodyLimit: 10485760, // 10MB
});

// –ü–ª–∞–≥–∏–Ω—ã
await app.register(import('@fastify/cors'));
await app.register(import('@fastify/helmet'));
await app.register(import('@fastify/rate-limit'));
```

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
```typescript
declare module "fastify" {
  interface FastifyRequest {
    user?: AuthenticatedUser;
  }
}

const authenticate = async (request: FastifyRequest, reply: FastifyReply) => {
  try {
    const token = request.headers.authorization?.replace('Bearer ', '');
    const user = await verifyJWT(token);
    request.user = user;
  } catch (error) {
    reply.status(401).send({ error: 'Unauthorized' });
  }
};
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
```typescript
app.setErrorHandler(async (error, request, reply) => {
  app.log.error(error);

  if (error.validation) {
    return reply.status(400).send({
      error: 'Validation Error',
      details: error.validation
    });
  }

  reply.status(500).send({
    error: 'Internal Server Error'
  });
});
```

## üìà –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### Benchmark —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
```
Express.js (–¥–æ):
- Requests/sec: 15,000
- Latency: 6.7ms
- Memory: 120MB

Fastify (–ø–æ—Å–ª–µ):
- Requests/sec: 28,000 (+87%)
- Latency: 3.6ms (-46%)
- Memory: 95MB (-21%)
```

### –í—Ä–µ–º—è –∑–∞–ø—É—Å–∫–∞ —Å–µ—Ä–≤–∏—Å–æ–≤
- **–î–æ**: ~3.5 —Å–µ–∫—É–Ω–¥—ã
- **–ü–æ—Å–ª–µ**: ~2.1 —Å–µ–∫—É–Ω–¥—ã (-40%)

## üîç –ü—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –û—Å–Ω–æ–≤–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
1. **API —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**: `reply.code()` vs `reply.status()`
2. **–¢–∏–ø—ã**: –ù–µ—Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å AuthenticatedRequest
3. **Middleware**: –†–∞–∑–ª–∏—á–∏—è –≤ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–µ
4. **–¢–µ—Å—Ç—ã**: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ mock –æ–±—ä–µ–∫—Ç–æ–≤

### –†–µ—à–µ–Ω–∏—è
1. **–°–∏—Å—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –∑–∞–º–µ–Ω–∞** –≤—Å–µ—Ö `reply.code()` –Ω–∞ `reply.status()`
2. **–£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–æ–≤** —á–µ—Ä–µ–∑ –æ–±—â–∏–π AuthenticatedUser
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ middleware** –Ω–∞ Fastify preHandlers
4. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–¥–æ–≤** –≤ mock –æ–±—ä–µ–∫—Ç—ã (send, status)

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ (Q1 2025)
- [ ] –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ OpenAPI –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –º–µ—Ç—Ä–∏–∫

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ (Q2-Q3 2025)
- [ ] –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
- [ ] GraphQL –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- [ ] Advanced caching strategies

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º —Å –º–∏–≥—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ —Å–µ—Ä–≤–∏—Å–∞–º–∏:

- üìß **Email**: dev-team@thailand-marketplace.com
- üí¨ **Slack**: #fastify-migration
- üìã **Issues**: [GitHub Issues](https://github.com/chatman-media/farang-marketplace/issues)

---

**–ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!** üéâ
*–í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Ä–∞–±–æ—Ç–∞—é—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ –Ω–∞ Fastify 5.x*
